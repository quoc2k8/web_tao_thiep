<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<!-- Ch·∫∑n zoom -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Happy Birthday!</title>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Pacifico&family=Quicksand:wght@600&display=swap" rel="stylesheet">

<style>
    /* --- C·∫§U H√åNH T·ª∂ L·ªÜ VMIN --- */
    :root {
        --env-width: 60vmin; 
        --env-height: 40vmin;
        --bg-color: radial-gradient(circle at center, #2b32b2, #1488cc);
        --env-color: #d63031; /* ƒê·ªè ƒë√¥ */
        --flap-color: #ff7675; /* H·ªìng cam */
    }

    body {
        margin: 0;
        padding: 0;
        height: 100vh;
        width: 100vw;
        background: var(--bg-color);
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: 'Quicksand', sans-serif;
        overflow: hidden;
    }

    /* --- PHONG B√å --- */
    .envelope-wrapper {
        position: relative;
        cursor: pointer;
        transform: translateY(10vmin); 
    }

    .envelope {
        position: relative;
        width: var(--env-width);
        height: var(--env-height);
        background: var(--env-color);
        border-radius: 1vmin;
        box-shadow: 0 2vmin 5vmin rgba(0,0,0,0.4);
    }

    .flap {
        position: absolute;
        top: 0; left: 0; width: 0; height: 0;
        border-left: calc(var(--env-width) / 2) solid transparent;
        border-right: calc(var(--env-width) / 2) solid transparent;
        border-top: calc(var(--env-height) * 0.6) solid var(--flap-color);
        transform-origin: top;
        transition: transform 0.6s ease-in-out, z-index 0.2s;
        z-index: 5;
    }

    /* T√∫i k√≠n 4 c·∫°nh */
    .pocket {
        position: absolute;
        bottom: 0; left: 0; width: 0; height: 0;
        border-left: calc(var(--env-width) / 2) solid var(--env-color);
        border-right: calc(var(--env-width) / 2) solid var(--env-color);
        border-bottom: calc(var(--env-height) * 0.55) solid #b71540;
        border-top: calc(var(--env-height) * 0.55) solid transparent;
        border-radius: 0 0 1vmin 1vmin;
        z-index: 4;
    }

    .seal {
        position: absolute;
        top: calc(var(--env-height) * 0.6); 
        left: 50%;
        transform: translate(-50%, -50%);
        width: 10vmin; height: 10vmin;
        background: #f1c40f;
        border-radius: 50%;
        z-index: 6;
        display: flex; justify-content: center; align-items: center;
        font-size: 5vmin;
        border: 0.5vmin solid #e67e22;
        box-shadow: 0 1vmin 2vmin rgba(0,0,0,0.2);
        transition: opacity 0.4s;
    }

    /* --- THI·ªÜP --- */
    .card {
        position: absolute;
        bottom: 0; left: 50%;
        transform: translateX(-50%);
        width: calc(var(--env-width) * 0.9);
        height: calc(var(--env-height) * 0.85); 
        background: #fff;
        border-radius: 1vmin;
        transition: all 1s ease-in-out;
        z-index: 2;
        padding: 2vmin;
        box-sizing: border-box;
        overflow: hidden;
        display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;
        box-shadow: 0 1vmin 2vmin rgba(0,0,0,0.1);
    }

    .card h1 {
        font-family: 'Pacifico', cursive;
        color: #d63031; margin: 0;
        font-size: 5vmin; line-height: 1.2;
    }
    .card p {
        font-family: 'Dancing Script', cursive;
        font-size: 3.5vmin; color: #333; margin: 1vmin 0;
    }

    /* --- ANIMATION --- */
    .envelope-wrapper.open .flap { transform: rotateX(180deg); z-index: 1; }
    .envelope-wrapper.open .seal { opacity: 0; }
    .envelope-wrapper.open .card {
        z-index: 100;
        animation: cardFlyOut 1.5s forwards; 
        animation-delay: 0.5s;
        overflow: visible;
    }

    @keyframes cardFlyOut {
        0% { bottom: 0; transform: translateX(-50%) scale(1); }
        40% { bottom: 20vmin; transform: translateX(-50%) scale(1); }
        100% {
            bottom: 50%; 
            transform: translate(-50%, 50%) scale(1.5); 
            box-shadow: 0 5vmin 10vmin rgba(0,0,0,0.5);
        }
    }

    .hint-text {
        position: absolute; bottom: -15vmin; width: 100%; text-align: center;
        color: white; font-size: 4vmin; animation: pulse 1s infinite;
    }
    @keyframes pulse { 0% { opacity: 0.6; } 100% { opacity: 1; } }

    #canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; }
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<div class="envelope-wrapper" id="envelope" onclick="openEnvelope()">
    <div class="envelope">
        <div class="flap"></div>
        <div class="seal">‚ù§Ô∏è</div>
        <div class="pocket"></div>
        <div class="card">
            <h1>Happy Birthday<br>{{ info.person_name }}</h1>
            <p>{{ info.cau_chuc }}</p>
            <div style="font-size: 6vmin; margin-top: 1vmin;">üéÇ üéâ üéÅ</div>
        </div>
    </div>
    <div class="hint-text">Ch·∫°m ƒë·ªÉ m·ªü th∆∞ üëÜ</div>
</div>

<script>
    let isOpened = false;
    let isGentleMode = false; // Bi·∫øn ki·ªÉm so√°t ch·∫ø ƒë·ªô nh·∫π nh√†ng

    function openEnvelope() {
        if (isOpened) return;
        isOpened = true;
        const envelope = document.getElementById('envelope');
        const hint = document.querySelector('.hint-text');
        
        envelope.classList.add('open');
        hint.style.display = 'none';

        // 1. K√≠ch ho·∫°t ph√°o hoa n·ªï l·ªõn sau 1.2s
        setTimeout(() => { fireworks(); }, 1200);

        // 2. K√≠ch ho·∫°t ch·∫ø ƒë·ªô nh·∫π nh√†ng (tim bay) sau 5s (khi ph√°o hoa ƒë√£ v√£n)
        setTimeout(() => { isGentleMode = true; }, 5000);
    }

    // --- CANVAS ENGINE ---
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let W = window.innerWidth;
    let H = window.innerHeight;
    canvas.width = W; canvas.height = H;

    let particles = [];      // M·∫£ng ch·ª©a ph√°o hoa n·ªï
    let gentleParticles = []; // M·∫£ng ch·ª©a tim bay nh·∫π nh√†ng

    // --- CLASS 1: PH√ÅO HOA N·ªî (Heavy) ---
    const colors = ["#ffbe0b", "#fb5607", "#ff006e", "#8338ec", "#3a86ff"];
    class FireworkParticle {
        constructor() {
            this.x = W / 2; this.y = H / 2;
            this.vx = (Math.random() - 0.5) * (W * 0.03); // T·ªëc ƒë·ªô nhanh
            this.vy = (Math.random() - 0.5) * (H * 0.03);
            this.color = colors[Math.floor(Math.random() * colors.length)];
            this.size = Math.random() * 5 + 3;
            this.life = 80; // S·ªëng ng·∫Øn
        }
        update() {
            this.x += this.vx; this.y += this.vy;
            this.size *= 0.96; this.life--;
        }
        draw() {
            ctx.fillStyle = this.color;
            ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill();
        }
    }

    // --- CLASS 2: HI·ªÜU ·ª®NG NH·∫∏ NH√ÄNG (Light) ---
    class GentleParticle {
        constructor() {
            this.x = Math.random() * W; // V·ªã tr√≠ ng·∫´u nhi√™n chi·ªÅu ngang
            this.y = H + 20;            // B·∫Øt ƒë·∫ßu t·ª´ d∆∞·ªõi ƒë√°y m√†n h√¨nh
            this.vy = Math.random() * -1.5 - 0.5; // Bay l√™n r·∫•t ch·∫≠m
            this.opacity = 0;           // B·∫Øt ƒë·∫ßu ·∫©n
            this.fadeIn = true;
            this.type = Math.random() > 0.5 ? "heart" : "star"; // Tim ho·∫∑c Sao
            this.size = Math.random() * 20 + 10;
            this.oscillation = Math.random() * 0.02; // ƒê·ªô l·∫Øc l∆∞
            this.angle = 0;
        }
        update() {
            this.y += this.vy;
            this.angle += this.oscillation;
            this.x += Math.sin(this.angle) * 0.5; // L·∫Øc l∆∞ nh·∫π sang 2 b√™n
            
            // Hi·ªán d·∫ßn l√™n
            if(this.fadeIn) {
                this.opacity += 0.01;
                if(this.opacity >= 0.8) this.fadeIn = false;
            }
            // X√≥a n·∫øu bay qu√° cao
            if(this.y < -50) this.dead = true;
        }
        draw() {
            ctx.globalAlpha = this.opacity;
            ctx.font = this.size + "px Arial";
            if(this.type === "heart") ctx.fillText("‚ù§Ô∏è", this.x, this.y);
            else ctx.fillText("‚ú®", this.x, this.y);
            ctx.globalAlpha = 1;
        }
    }

    function fireworks() {
        let count = 0;
        let interval = setInterval(() => {
            for(let i=0; i<50; i++) particles.push(new FireworkParticle());
            count++; if(count > 20) clearInterval(interval); // N·ªï 20 ƒë·ª£t r·ªìi d·ª´ng
        }, 100);
        loop();
    }

    function loop() {
        requestAnimationFrame(loop);
        ctx.clearRect(0,0,W,H);

        // 1. X·ª≠ l√Ω Ph√°o hoa (N·ªï r·ªìi t·∫Øt)
        for(let i=0; i<particles.length; i++) {
            particles[i].update(); particles[i].draw();
            if(particles[i].life <= 0) { particles.splice(i,1); i--; }
        }

        // 2. X·ª≠ l√Ω Hi·ªáu ·ª©ng nh·∫π nh√†ng (Th√™m li√™n t·ª•c n·∫øu ƒë√£ k√≠ch ho·∫°t)
        if(isGentleMode) {
            // T·ª∑ l·ªá sinh ra h·∫°t m·ªõi (0.05 nghƒ©a l√† kho·∫£ng 20 frame m·ªõi ra 1 h·∫°t -> th∆∞a th·ªõt)
            if(Math.random() < 0.04) { 
                gentleParticles.push(new GentleParticle());
            }
        }

        for(let i=0; i<gentleParticles.length; i++) {
            gentleParticles[i].update(); gentleParticles[i].draw();
            if(gentleParticles[i].dead) { gentleParticles.splice(i,1); i--; }
        }
    }
    
    window.onresize = () => { W = window.innerWidth; H = window.innerHeight; canvas.width = W; canvas.height = H; };
</script>

</body>
</html>